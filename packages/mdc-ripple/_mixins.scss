//
// Copyright 2016 Google Inc. All Rights Reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//

@import "@material/animation/variables";
@import "@material/theme/variables";
@import "./keyframes";

@function mdc-ripple-default-config_() {
  @return (
    radius: 100%,
    base-color: black,
    opacity: .06,
    theme-style: null
  );
}

@mixin mdc-ripple-base() {
  --mdc-ripple-surface-width: 0;
  --mdc-ripple-surface-height: 0;
  --mdc-ripple-fg-size: 0;
  --mdc-ripple-left: 0;
  --mdc-ripple-top: 0;
  --mdc-ripple-fg-scale: 1;
  --mdc-ripple-fg-translate-end: 0;
  --mdc-ripple-fg-translate-start: 0;

  will-change: transform, opacity;
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);

  &:not(.mdc-ripple-upgraded) {
    &:hover::before,
    &:focus::before,
    &:active::after {
      transition-duration: 85ms;
      opacity: .6;
    }
  }
}

@mixin mdc-ripple-color_($config) {
  $base-color: map-get($config, base-color);
  $opacity: map-get($config, opacity);
  $theme-style: map-get($config, theme-style);

  // stylelint-disable at-rule-empty-line-before, block-closing-brace-newline-after
  @if ($theme-style) {
    $theme-value: map-get($mdc-theme-property-values, $theme-style);

    /* @alternate */
    $css-var: $theme-value;
    $css-var: var(--mdc-theme-#{$theme-style}, $theme-value);

    background-color: rgba($theme-value, $opacity);

    // See: https://drafts.csswg.org/css-color/#modifying-colors
    // While this is currently unsupported as of now, it will begin to work by default as browsers
    // begin to implement the CSS 4 color spec.
    @supports (background-color: color(green a(10%))) {
      background-color: color(#{$css-var} a(#{percentage($opacity)}));
    }
  } @else {
    background-color: rgba($base-color, $opacity);
  }

  // stylelint-enable at-rule-empty-line-before, block-closing-brace-newline-after
}

@mixin mdc-ripple-bg-base_($config) {
  $radius: map-get($config, radius);

  @include mdc-ripple-color_($config);

  position: absolute;
  top: calc(50% - #{$radius});
  left: calc(50% - #{$radius});
  width: $radius * 2;
  height: $radius * 2;
  transition: opacity 250ms linear;
  border-radius: 50%;
  opacity: 0;
  pointer-events: none;
}

@mixin mdc-ripple-bg-upgraded_($radius) {
  top: calc(50% - #{$radius});
  left: calc(50% - #{$radius});
  width: $radius * 2;
  height: $radius * 2;

  /* @alternate */
  transform: scale(0);
  transform: scale(var(--mdc-ripple-fg-scale, 0));
}

@mixin mdc-ripple-bg-focused_() {
  opacity: .99999;
}

@mixin mdc-ripple-bg-active-fill_() {
  transition-duration: 120ms;
  opacity: 1;
}

@mixin mdc-ripple-unbounded_($radius) {
  /* @alternate */
  top: calc(50% - #{$radius / 2});
  top: var(--mdc-ripple-top, calc(50% - #{$radius / 2}));

  /* @alternate */
  left: calc(50% - #{$radius / 2});
  left: var(--mdc-ripple-left, calc(50% - #{$radius / 2}));

  /* @alternate */
  width: $radius;
  width: var(--mdc-ripple-fg-size, $radius);

  /* @alternate */
  height: $radius;
  height: var(--mdc-ripple-fg-size, $radius);

  /* @alternate */
  transform: scale(0);
  transform: scale(var(--mdc-ripple-fg-scale, 0));
}

@mixin mdc-ripple-bg-before($config: ()) {
  $config: map-merge(mdc-ripple-default-config_(), $config);
  $radius: map-get($config, radius);

  &::before {
    @include mdc-ripple-bg-base_($config);

    content: "";
  }

  &.mdc-ripple-upgraded::before {
    @include mdc-ripple-bg-upgraded_($radius);
  }

  &.mdc-ripple-upgraded--background-focused::before {
    @include mdc-ripple-bg-focused_;
  }

  &.mdc-ripple-upgraded--background-active-fill::before {
    @include mdc-ripple-bg-active-fill_;
  }

  &.mdc-ripple-upgraded--unbounded::before {
    @include mdc-ripple-unbounded_($radius);
  }
}

@mixin mdc-ripple-bg($config: ()) {
  $config: map-merge(mdc-ripple-default-config_(), $config);
  $radius: map-get($config, radius);

  @include mdc-ripple-bg-base_($config);

  &.mdc-ripple-upgraded {
    @include mdc-ripple-upgraded_($radius);
  }

  &.mdc-ripple-upgraded--background-focused {
    @include mdc-ripple-bg-focused_;
  }

  &.mdc-ripple-upgraded--background-active-fill {
    @include mdc-ripple-bg-active-fill_;
  }

  &.mdc-ripple-upgraded--unbounded {
    @include mdc-ripple-bg-unbounded_($radius);
  }
}

@mixin mdc-ripple-fg-base_($config) {
  $radius: map-get($config, radius);

  @include mdc-ripple-color_($config);

  position: absolute;
  top: calc(50% - #{$radius});
  left: calc(50% - #{$radius});
  width: $radius * 2;
  height: $radius * 2;
  transition: opacity 250ms linear;
  border-radius: 50%;
  opacity: 0;
  pointer-events: none;
}

@mixin mdc-ripple-fg-upgraded_($radius) {
  top: 0;
  left: 0;

  /* @alternate */
  width: $radius;
  width: var(--mdc-ripple-fg-size, $radius);

  /* @alternate */
  height: $radius;
  height: var(--mdc-ripple-fg-size, $radius);
  transform: scale(0);
  transform-origin: center center;
  opacity: 0;
}

@mixin mdc-ripple-fg-bounded_() {
  transform-origin: center center;
}

@mixin mdc-ripple-fg-unbounded_($radius) {
  /* @alternate */
  top: 0;
  top: var(--mdc-ripple-top, 0);

  /* @alternate */
  left: 0;
  left: var(--mdc-ripple-left, 0);

  /* @alternate */
  width: $radius;
  width: var(--mdc-ripple-fg-size, $radius);

  /* @alternate */
  height: $radius;
  height: var(--mdc-ripple-fg-size, $radius);
  transform: scale(0);
  transform-origin: center center;
}

@mixin mdc-ripple-fg-activation_() {
  animation: 300ms mdc-ripple-fg-radius-in forwards, 83ms mdc-ripple-fg-opacity-in forwards;
}

@mixin mdc-ripple-fg-deactivation_() {
  // Retain transform from mdc-ripple-fg-radius-in activation
  transform: translate(var(--mdc-ripple-fg-translate-end, 0)) scale(var(--mdc-ripple-fg-scale, 1));
  animation: 83ms mdc-ripple-fg-opacity-out;
}

@mixin mdc-ripple-fg-after($config: ()) {
  $config: map-merge(mdc-ripple-default-config_(), $config);
  $radius: map-get($config, radius);

  &::after {
    @include mdc-ripple-fg-base_($config);

    content: "";
  }

  &.mdc-ripple-upgraded::after {
    @include mdc-ripple-fg-upgraded_($radius);
  }

  &:not(.mdc-ripple-upgraded--unbounded)::after {
    @include mdc-ripple-fg-bounded_;
  }

  &.mdc-ripple-upgraded--unbounded::after {
    @include mdc-ripple-fg-unbounded_($radius);
  }

  &.mdc-ripple-upgraded--foreground-activation::after {
    @include mdc-ripple-fg-activation_;
  }

  &.mdc-ripple-upgraded--foreground-deactivation::after {
    @include mdc-ripple-fg-deactivation_;
  }
}

@mixin mdc-ripple-fg($config: ()) {
  $config: map-merge(mdc-ripple-default-config_(), $config);
  $radius: map-get($config, radius);

  @include mdc-ripple-fg-base_($config);

  &.mdc-ripple-upgraded {
    @include mdc-ripple-fg-upgraded_($radius);
  }

  &:not(.mdc-ripple-upgraded--unbounded) {
    @include mdc-ripple-fg-bounded_;
  }

  &.mdc-ripple-upgraded--unbounded {
    @include mdc-ripple-fg-unbounded_($radius);
  }

  &.mdc-ripple-upgraded--foreground-activation {
    @include mdc-ripple-fg-activation_;
  }

  &.mdc-ripple-upgraded--foreground-deactivation {
    @include mdc-ripple-fg-deactivation_;
  }
}
